#!/usr/bin/env perl
use Modern::Perl;
use FindBin::libs;
use CodeJuicer;
use CodeJuicer::Worker;
use Daemon::Control;

Daemon::Control->new({
  name        => 'codejuicer-worker',
  lsb_start   => '$syslog $remote_fs',
  lsb_stop    => '$syslog',
  lsb_sdesc   => 'CodeJuicer Gearman Worker.',
  lsb_desc    => 'Controls the codejuicer-worker daemon.',
  init_config => '/etc/default/codejuicer',
  path        => "$CodeJuicer::BINDIR/codejuicer-worker",
  program     => sub { CodeJuicer::Worker->start },
  directory   => $CodeJuicer::SHAREDIR,
  pid_file    => "$CodeJuicer::RUNDIR/codejuicer-worker.pid",
  stderr_file => "$CodeJuicer::LOGDIR/codejuicer-worker.log",
  stdout_file => "$CodeJuicer::LOGDIR/codejuicer-worker.log",
  fork        => 2,
})->run;
